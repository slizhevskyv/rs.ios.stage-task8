//
//  Canvas.m
//  rs.ios.stage-task8
//
//  Created by Vladislav Slizhevsky on 7/18/21.
//

#import "Canvas.h"

@interface Canvas ()

@property (nonatomic) UIBezierPath *firstPath;
@property (nonatomic) UIBezierPath *secondPath;
@property (nonatomic) UIBezierPath *thirdPath;
@property (nonatomic, assign) NSInteger coordinatesIdx;
@property (nonatomic, strong) NSDictionary<NSString *, NSArray<NSMutableArray<NSNumber *> *> *> *templates;
@property (nonatomic, assign, readwrite) BOOL isDrawingDone;
@property (nonatomic, assign) BOOL isCoordinatesNormalized;

@end

@implementation Canvas

- (instancetype)init
{
    self = [super init];
    if (self) {
        _isReadyToDraw = NO;
        _isDrawingDone = NO;
        _isCoordinatesNormalized = NO;
        _reset = NO;
        _coordinatesIdx = 1;
        _firstPath = [UIBezierPath new];
        _secondPath = [UIBezierPath new];
        _thirdPath = [UIBezierPath new];
        _colors = @[];
        _templates = @{
            @"Planet": @[
                [NSMutableArray arrayWithArray:@[
                    @[@252.5, @192, @YES],
                    @[@257.5, @188.5, @NO],
                    @[@264.5, @189, @NO],
                    @[@269, @192.5, @NO],
                    @[@270.5, @197.5, @NO],
                    @[@269.5, @202, @NO],
                    @[@266.5, @206.5, @NO],
                    @[@261.5, @208, @NO],
                    @[@255.5, @207, @NO],
                    @[@251.5, @203, @NO],
                    @[@250, @198, @NO],
                    @[@252.5, @192, @NO],
                    @[@-1, @-1, @NO],
                    @[@240, @222, @YES],
                    @[@242, @220, @NO],
                    @[@244.5, @220, @NO],
                    @[@246.5, @221.5, @NO],
                    @[@247, @224, @NO],
                    @[@246, @226, @NO],
                    @[@243.5, @227, @NO],
                    @[@241, @226.5, @NO],
                    @[@239.5, @224.5, @NO],
                    @[@240, @222, @NO],
                    @[@-1, @-1, @NO],
                    @[@74.5, @253, @YES],
                    @[@76.5, @252, @NO],
                    @[@79.5, @253, @NO],
                    @[@81, @255.5, @NO, @80, @253.67, @81, @255.1],
                    @[@81, @258.5, @NO, @81, @255.9, @81.17, @257.83000000000004],
                    @[@78.5, @260, @NO],
                    @[@75, @260, @NO],
                    @[@73.5, @258, @NO],
                    @[@73, @255.5, @NO],
                    @[@74.5, @253, @NO],
                    @[@-1, @-1, @NO],
                    @[@35.5, @87.5, @YES],
                    @[@41.5, @83, @NO, @37.33, @86, @41.1, @83],
                    @[@48, @82, @NO],
                    @[@54.5, @84, @NO],
                    @[@60.5, @91, @NO],
                    @[@61, @100.5, @NO],
                    @[@57, @108, @NO],
                    @[@48.5, @112, @NO],
                    @[@39.5, @110, @NO],
                    @[@33.5, @105.5, @NO],
                    @[@31.5, @96.5, @NO],
                    @[@35.5, @87.5, @NO],
                    @[@-1, @-1, @NO],
                    @[@217, @62, @YES],
                    @[@222.5, @61, @NO, @218, @61.67, @222.1, @61],
                    @[@227, @64, @NO],
                    @[@227.5, @69, @NO],
                    @[@225.5, @73, @NO],
                    @[@220.5, @74.5, @NO],
                    @[@215.5, @72, @NO],
                    @[@214, @66.5, @NO],
                    @[@217, @62, @NO],
                    @[@-1, @-1, @NO],
                ]],
                [NSMutableArray arrayWithArray:@[
                    @[@60.5, @157, @YES],
                    @[@51.5, @161, @NO],
                    @[@42.5, @168, @NO],
                    @[@34, @176, @NO],
                    @[@28, @184, @NO],
                    @[@26, @192, @NO],
                    @[@27, @200, @NO],
                    @[@31, @206.5, @NO],
                    @[@38, @212, @NO],
                    @[@48.5, @216.5, @NO],
                    @[@59.5, @219, @NO],
                    @[@71, @220, @NO],
                    @[@82, @220.5, @NO],
                    @[@88.5, @220.3, @NO],
                    @[@60.5, @157, @YES],
                    @[@61, @150, @NO],
                    @[@63.5, @137.5, @NO],
                    @[@67, @127, @NO],
                    @[@71.5, @115.5, @NO],
                    @[@77, @107, @NO],
                    @[@84, @97.5, @NO],
                    @[@92, @90, @NO],
                    @[@100, @84.5, @NO],
                    @[@108.5, @79.5, @NO],
                    @[@120, @74.5, @NO, @112.17, @78, @119.6, @74.9],
                    @[@131, @71, @NO, @120.4, @74.1, @127.5, @72],
                    @[@147.5, @69.5, @NO],
                    @[@161.5, @70.5, @NO],
                    @[@175.5, @73, @NO],
                    @[@188, @78, @NO],
                    @[@200, @85.5, @NO],
                    @[@208.5, @92.5, @NO],
                    @[@215.5, @99.5, @NO],
                    @[@221.5, @106.5, @NO],
                    @[@60.5, @157, @YES],
                    @[@60.5, @163.5, @NO],
                    @[@61.5, @171, @NO],
                    @[@221.5, @106.5, @YES],
                    @[@230.5, @105, @NO],
                    @[@242.5, @104.5, @NO],
                    @[@254, @106, @NO],
                    @[@264.5, @110, @NO],
                    @[@271.5, @115.5, @NO],
                    @[@274, @123, @NO],
                    @[@273.5, @132, @NO],
                    @[@270, @140.5, @NO],
                    @[@259.5, @154, @NO],
                    @[@251, @162.5, @NO],
                    @[@238, @172.5, @NO],
                    @[@234.67, @174.5, @NO],
                    @[@221.5, @106.5, @YES],
                    @[@225, @111.5, @NO],
                    @[@228, @118, @NO],
                    @[@61.5, @171, @YES],
                    @[@57.5, @173.5, @NO],
                    @[@54, @178, @NO],
                    @[@52.5, @183, @NO],
                    @[@53, @188, @NO],
                    @[@55.5, @192, @NO],
                    @[@60.5, @195, @NO],
                    @[@68, @198, @NO],
                    @[@70.5, @198.47, @NO],
                    @[@61.5, @171, @YES],
                    @[@64, @179.5, @NO],
                    @[@66.5, @188, @NO],
                    @[@70.5, @198.47, @NO],
                    @[@228, @118, @YES],
                    @[@234.5, @118, @NO],
                    @[@242.5, @121, @NO],
                    @[@245.5, @125, @NO],
                    @[@246, @131, @NO],
                    @[@244.5, @136.5, @NO],
                    @[@240.5, @142, @NO],
                    @[@236.83, @146, @NO],
                    @[@228, @118, @YES],
                    @[@231, @125, @NO],
                    @[@234.67, @136.5, @NO],
                    @[@236.83, @146, @NO],
                    @[@88.5, @220.3, @YES],
                    @[@98.5, @220, @NO],
                    @[@119.5, @217.5, @NO],
                    @[@137, @214, @NO],
                    @[@152.5, @210, @NO],
                    @[@172, @204, @NO],
                    @[@191.5, @196.5, @NO],
                    @[@207, @189.5, @NO],
                    @[@223, @181.5, @NO],
                    @[@234.67, @174.5, @NO],
                    @[@88.5, @220.3, @YES],
                    @[@93.5, @226, @NO],
                    @[@101.5, @232, @NO],
                    @[@110.5, @236.5, @NO],
                    @[@119.5, @240, @NO],
                    @[@130.5, @243.5, @NO],
                    @[@143, @245.5, @NO],
                    @[@155, @245.5, @NO],
                    @[@166, @244.5, @NO],
                    @[@175.5, @242, @NO],
                    @[@183, @239, @NO],
                    @[@192.5, @234.5, @NO],
                    @[@200, @229.5, @NO],
                    @[@206, @225, @NO],
                    @[@214, @216.5, @NO],
                    @[@222, @206.5, @NO],
                    @[@227.5, @197, @NO],
                    @[@232.5, @185, @NO],
                    @[@234.67, @174.5, @NO],
                    @[@236.83, @146, @YES],
                    @[@235, @148, @NO],
                    @[@230, @153, @NO],
                    @[@224, @157.5, @NO],
                    @[@216.5, @162.5, @NO],
                    @[@209.5, @167, @NO],
                    @[@202.5, @171, @NO],
                    @[@195.5, @174.5, @NO],
                    @[@186.5, @179, @NO],
                    @[@175, @184, @NO],
                    @[@163.5, @188, @NO],
                    @[@151.5, @191.5, @NO],
                    @[@140, @194.5, @NO],
                    @[@128, @197, @NO],
                    @[@116, @199, @NO],
                    @[@104, @200, @NO],
                    @[@92.5, @200.5, @NO],
                    @[@83.5, @200, @NO],
                    @[@76, @199.5, @NO],
                    @[@70.5, @198.47, @NO],
                ]],
                [NSMutableArray arrayWithArray:@[
                    @[@156, @117.5, @YES],
                    @[@162, @114.5, @NO],
                    @[@171.5, @109, @NO],
                    @[@181, @102, @NO],
                    @[@187.5, @95, @NO],
                    @[@191.5, @88, @NO],
                    @[@194, @82, @NO],
                    @[@109.5, @96, @YES],
                    @[@102.5, @95.5, @NO],
                    @[@96.5, @93.5, @NO],
                    @[@91.5, @90.5, @NO],
                    @[@120, @94.5, @YES],
                    @[@127.5, @92.5, @NO],
                    @[@135.5, @90, @NO],
                    @[@143.5, @85.5, @NO],
                    @[@151, @80, @NO, @145.82999999999998, @83.83, @150.6, @80.4],
                    @[@155.5, @75, @NO, @151.4, @79.6, @154.17000000000002, @76.5],
                    @[@157.5, @70.5, @NO],
                    @[@97.5, @111.5, @YES],
                    @[@102, @112.5, @NO],
                    @[@109.5, @112.5, @NO],
                    @[@117.5, @111.5, @NO],
                    @[@124.5, @110, @NO],
                    @[@133, @108, @NO],
                    @[@103, @131, @YES],
                    @[@107, @130.5, @NO, @103.4, @131, @105.83, @130.67000000000002],
                    @[@111.5, @130, @NO],
                    @[@115.5, @129, @NO],
                    @[@94.5, @130.5, @YES],
                    @[@87, @130, @NO],
                    @[@80, @127.5, @NO],
                    @[@73.5, @124.5, @NO, @78, @126.5, @73.9, @124.5],
                    @[@69, @122, @NO, @73.1, @124.5, @70.33, @122.83],
                    @[@86.5, @169.5, @YES],
                    @[@78.5, @168, @NO],
                    @[@69.5, @164.5, @NO],
                    @[@60.5, @159, @NO],
                    @[@106.5, @169.5, @YES],
                    @[@112, @169.5, @NO],
                    @[@116.5, @169, @NO],
                    @[@125.5, @167.5, @NO],
                    @[@136, @165, @NO],
                    @[@145.5, @162.5, @NO],
                    @[@155, @159.5, @NO],
                    @[@164.5, @156.5, @NO],
                    @[@174.5, @152, @NO],
                    @[@184, @147.5, @NO],
                    @[@192, @142.5, @NO],
                    @[@198, @138.5, @NO],
                    @[@203.5, @135, @NO],
                    @[@212, @127, @YES],
                    @[@216, @122, @NO],
                    @[@219.5, @116, @NO],
                    @[@222.5, @108.5, @NO],
                    @[@125.5, @148, @YES],
                    @[@133.5, @146, @NO],
                    @[@146.5, @142, @NO],
                    @[@155, @139, @NO],
                    @[@164, @135, @NO],
                    @[@171.5, @131.5, @NO],
                    @[@178, @128, @NO],
                    @[@86.5, @187, @YES],
                    @[@93.5, @187.5, @NO],
                    @[@101, @187.5, @NO],
                    @[@109, @186.5, @NO],
                    @[@190.5, @162.5, @YES],
                    @[@196.5, @160.5, @NO],
                    @[@204, @156, @NO],
                    @[@213, @149, @NO],
                    @[@219, @144.5, @NO],
                    @[@223, @140, @NO],
                    @[@167, @216.5, @YES],
                    @[@171.5, @215.5, @NO],
                    @[@180.5, @212, @NO],
                    @[@188.5, @208.5, @NO],
                    @[@195, @205.5, @NO],
                    @[@201, @202.5, @NO],
                    @[@203.5, @199.5, @NO],
                    @[@208.5, @212, @YES],
                    @[@214.5, @208.5, @NO],
                    @[@220, @204.5, @NO],
                    @[@227.5, @197, @NO],
                    @[@198, @218, @YES],
                    @[@190.5, @221.5, @NO],
                    @[@180, @225.5, @NO],
                    @[@170, @229, @NO],
                    @[@159, @232, @NO],
                    @[@148.5, @234.5, @NO],
                    @[@134.5, @236, @NO],
                    @[@121, @236.5, @NO],
                    @[@109.5, @236, @NO],
                ]],
            ],
            @"Tree": @[
                [NSMutableArray arrayWithArray:@[
                     @[@230.92, @57.45, @NO],
                     @[@235, @47.5, @NO, @233.45, @54.77, @235, @51.3],
                 
                     @[@235, @47.5, @NO],
                     @[@217.5, @32, @NO, @235, @38.82, @227.04, @32],
                      
                     @[@217.5, @32, @NO],
                     @[@212.72, @32.58, @NO, @215.85, @32, @214.24, @32.2],
                      
                     @[@213.96, @33.480000000000004, @NO],
                     @[@196.5, @19, @NO, @213.36, @25.29, @205.67, @19],
                      
                     @[@196.5, @19, @NO],
                     @[@188.16, @20.869999999999997, @NO, @193.49, @19, @190.65, @19.67],
                       
                     @[@189.22, @20.990000000000002, @NO],
                     @[@177.5, @17, @NO, @186.11, @18.5, @182, @17],
                       
                     @[@177.5, @17, @NO],
                     @[@172.72, @17.58, @NO, @175.85, @17, @174.24, @17.2],
                       
                     @[@173.95999999999998, @18.48, @NO],
                     @[@156.5, @5, @NO, @173.36, @10.29, @165.67000000000002, @5],
                       
                     @[@156.5, @5, @NO],
                     @[@141.78, @11.11, @NO, @150.35, @5, @144.91, @6.8100000000000005],
                       
                     @[@142.86, @10.74, @NO],
                     @[@137.5, @10, @NO, @141.17000000000002, @10.26, @139.37, @10],
                       
                     @[@137.5, @10, @NO],
                     @[@127.27, @12.92, @NO, @133.69, @10, @130.15, @11.08],
                       
                     @[@128.09, @12.809999999999999, @NO],
                     @[@122.5, @12, @NO, @126.33, @12.280000000000001, @124.45, @12],
                       
                     @[@122.5, @12, @NO],
                     @[@107.78, @19.11, @NO, @116.35, @12, @110.91, @14.81],
                       
                     @[@108.86, @18.740000000000002, @NO],
                     @[@103.5, @18, @NO, @107.17, @18.259999999999998, @105.37, @18],
                       
                     @[@103.5, @18, @NO],
                     @[@86, @33.5, @NO, @93.96000000000001, @18, @86, @24.82],
                       
                     @[@86, @33.5, @NO],
                     @[@86.01, @34.06, @NO, @86, @33.69, @86, @33.879999999999995],
                       
                     @[@86.3, @33.32, @NO],
                     @[@84.78, @35.11, @NO, @85.75, @33.879999999999995, @85.24, @34.480000000000004],
                       
                     @[@85.86, @34.739999999999995, @NO],
                     @[@80.5, @34, @NO, @84.17, @34.260000000000005, @82.37, @34],
                       
                     @[@80.5, @34, @NO],
                     @[@63, @49.5, @NO, @70.96000000000001, @34, @63, @40.82],
                       
                     @[@63, @49.5, @NO],
                     @[@64.7, @56.18, @NO, @63, @51.89, @63.61, @54.16],
                      
                     @[@64.77, @55.12, @NO],
                     @[@62, @63.5, @NO, @63.02, @57.53, @62, @60.4],
                      
                     @[@62, @63.5, @NO],
                     @[@63.28, @69.34, @NO, @62, @65.57, @62.46, @67.53999999999999],
                       
                     @[@63.43, @68.28, @NO],
                     @[@63.43, @77.5, @NO, @61.28, @70.85, @60, @74.04],
                      
                     @[@60, @77.5, @NO],
                     @[@61.7, @84.18, @NO, @60, @79.89, @60.61, @82.16],
                       
                     @[@61.769999999999996, @83.12, @NO],
                     @[@60, @91.5, @NO, @60.019999999999996, @85.53, @60, @88.4],
                       
                     @[@60, @91.5, @NO],
                     @[@76.5, @107, @NO, @60, @100.18, @66.96000000000001, @107],
                       
                     @[@76.5, @107, @NO],
                     @[@78.78999999999999, @106.87, @NO, @77.28, @107, @78.03999999999999, @106.96],
                       
                     @[@77.8, @106.36, @NO],
                     @[@93.5, @115, @NO, @80.68, @111.52, @86.66, @115],
                       
                     @[@93.5, @115, @NO],
                     @[@101.78, @113.16, @NO, @96.49000000000001, @115, @99.31, @114.34],
                       
                     @[@100.45, @112.7, @NO],
                     @[@116.5, @122, @NO, @103.17, @118.22, @109.37, @122],
                       
                     @[@116.5, @122, @NO],
                     @[@118.78999999999999, @121.87, @NO, @117.28, @122, @118.03999999999999, @121.96],
                       
                     @[@117.8, @121.36, @NO],
                     @[@133.5, @130, @NO, @120.68, @126.52, @126.66, @130],
                       
                     @[@133.5, @130, @NO],
                     @[@142.47, @127.81, @NO, @136.76999999999998, @130, @139.84, @129.20999999999998],
                       
                     @[@141.53, @127.81, @NO],
                     @[@146.45, @129.57999999999998, @NO, @143.04000000000002, @128.61, @144.7, @129.22],
                       
                     @[@145.92000000000002, @129.28, @NO],
                     @[@159.5, @135, @NO, @149.14, @132.79000000000002, @154.04000000000002, @135],
                       
                     @[@159.5, @135, @NO],
                     @[@167.78, @133.16, @NO, @162.49, @135, @165.31, @134.34],
                       
                     @[@166.45, @132.7, @NO],
                     @[@182.5, @142, @NO, @169.17000000000002, @138.22, @175.37, @142],
                       
                     @[@182.5, @142, @NO],
                     @[@184.79000000000002, @141.87, @NO, @183.28, @142, @184.04000000000002, @141.96],
                       
                     @[@183.8, @141.36, @NO],
                     @[@199.5, @150, @NO, @186.68, @146.52, @192.66, @150],
                       
                     @[@199.5, @150, @NO],
                     @[@208.47, @147.81, @NO, @202.77, @150, @205.84, @149.21],
                       
                     @[@207.53, @147.81, @NO],
                     @[@216.5, @150, @NO, @210.16, @149.21, @213.23, @150],
                       
                     @[@216.5, @150, @NO],
                     @[@234, @134.5, @NO, @226.04, @150, @234, @143.18],
                       
                     @[@234, @134.5, @NO],
                     @[@233.99, @133.95, @NO, @234, @134.32, @234, @134.14],
                       
                     @[@232.96, @134.99, @NO],
                     @[@233.5, @135, @NO, @233.14, @135, @233.32, @135],
                       
                     @[@233.5, @135, @NO],
                     @[@242.47, @132.81, @NO, @236.77, @135, @239.84, @134.21],
                      
                     @[@241.53, @132.81, @NO],
                     @[@250.5, @135, @NO, @244.16, @134.21, @247.23, @135],
                       
                     @[@250.5, @135, @NO],
                     @[@268, @119.5, @NO, @260.03999999999996, @135, @268, @128.18],
                       
                     @[@268, @119.5, @NO],
                     @[@267.64, @116.33, @NO, @268, @118.42, @267.87, @117.36],
                       
                     @[@267.16999999999996, @117.42, @NO],
                     @[@275, @104.5, @NO, @271.85, @114.67, @275, @109.94],
                       
                     @[@275, @104.5, @NO],
                     @[@270.91999999999996, @94.55, @NO, @275, @100.7, @273.45, @97.23],
                       
                     @[@270.73, @96.08, @NO],
                     @[@278, @83.5, @NO, @275.1, @93.29, @278, @88.72],
                       
                     @[@278, @83.5, @NO],
                     @[@260.5, @68, @NO, @278, @74.82, @270.03999999999996, @68],
                      
                     @[@260.5, @68, @NO],
                     @[@255.72, @68.58, @NO, @258.85, @68, @257.24, @68.2],
                       
                     @[@256.96000000000004, @69.48, @NO],
                     @[@239.5, @55, @NO, @256.36, @61.29, @248.67, @55],
                      
                     @[@239.5, @55, @NO],
                     @[@231.16, @56.87, @NO, @236.49, @55, @233.65, @55.67],
                       
                     @[@232.22, @56.99, @NO],
                     @[@230.73, @55.92, @NO, @231.75, @56.61, @231.25, @56.25],
                ]],
                [NSMutableArray arrayWithArray:@[
                     @[@84, @242.5, @YES],
                     @[@145.5, @179.5, @NO, @103.83, @236.67000000000002, @143.9, @215.9],
                     @[@135.5, @132.5, @NO, @147.1, @143.1, @139.5, @133],
                     @[@227.5, @248, @YES],
                     @[@174, @219, @NO, @209.17000000000002, @247, @172.8, @239.8],
                     @[@185, @160.5, @NO, @175.2, @198.2, @181.82999999999998, @171.32999999999998],
                     @[@194.5, @148.5, @NO, @187.17000000000002, @156.17000000000002, @192.1, @147.7],
                     @[@160.5, @157, @YES],
                     @[@153, @206, @NO, @159, @172.17000000000002, @155.4, @203.2],
                     @[@165.5, @231.5, @YES],
                     @[@170.5, @160.5, @NO, @165.5, @223.5, @164.5, @175],
                     @[@147, @199.5, @YES],
                     @[@126.5, @228.5, @NO, @134, @218.5, @132.5, @223],
                ]],
                [NSMutableArray arrayWithArray:@[
                    @[@100.5, @235.5, @YES],
                    @[@67, @240.81, @NO, @92.5, @228, @77.4, @228],
                    @[@40.5, @247, @YES],
                    @[@64.5, @240, @NO, @43.83, @243.17, @53.3, @236.4],
                    @[@75, @244, @NO, @75.7, @243.6, @76.17, @244.17],
                    @[@179, @232.5, @YES],
                    @[@202.5, @232.5, @NO, @184, @229.73, @195.7, @228],
                    @[@207.74, @238.5, @NO, @204.78, @234.73, @206.48, @236.74],
                    @[@211, @245.5, @YES],
                    @[@207.74, @238.5, @NO, @211, @244.46, @210.25, @241.99],
                    @[@207.74, @238.5, @YES],
                    @[@242.5, @240, @NO, @219.33, @235.33, @242.5, @231.2],
                    @[@225.5, @248, @NO, @242.5, @248.8, @226.83, @247.17],
                ]]
            ],
            @"Landscape": @[
                [NSMutableArray arrayWithArray:@[
                    @[@98.5, @150, @YES],
                    @[@100.5, @156.5, @NO],
                    @[@101.5, @167.5, @NO],
                    @[@99, @186, @NO],
                    @[@95.5, @203.5, @NO],
                    @[@96, @213, @NO],
                    @[@99, @221, @NO],
                    @[@103.5, @221, @YES],
                    @[@104.5, @209.5, @NO],
                    @[@105.5, @205.5, @NO],
                    @[@104.5, @193.5, @YES],
                    @[@103.5, @185.5, @NO],
                    @[@102.5, @178, @NO],
                    @[@111, @172.5, @YES],
                    @[@113, @180.5, @NO],
                    @[@114.5, @191, @NO],
                    @[@116, @181.5, @YES],
                    @[@116.5, @187.5, @NO],
                    @[@119, @196.5, @NO],
                    @[@121.5, @202.5, @NO],
                    @[@120, @191, @YES],
                    @[@120.5, @195.5, @NO],
                    @[@124, @201.5, @NO],
                    @[@133, @179, @YES],
                    @[@134, @186, @NO],
                    @[@135.5, @193, @NO],
                    @[@138, @198.5, @NO],
                    @[@141.5, @200, @YES],
                    @[@138.5, @194, @NO],
                    @[@137, @189, @NO],
                    @[@136.5, @184, @NO],
                    @[@134, @193, @YES],
                    @[@132, @187, @NO],
                    @[@131, @181, @NO],
                    @[@130.5, @173, @NO],
                    @[@131, @166, @NO],
                    @[@74, @155.5, @YES],
                    @[@71.5, @163, @NO],
                    @[@70.5, @170, @NO],
                    @[@70.5, @178, @NO],
                    @[@68.5, @172.5, @YES],
                    @[@69, @164.5, @NO],
                    @[@71.5, @155.5, @NO],
                    @[@75, @148, @NO],
                    @[@77.5, @137, @YES],
                    @[@73.5, @143, @NO],
                    @[@70.5, @149, @NO],
                    @[@33.5, @178, @YES],
                    @[@31.5, @186, @NO],
                    @[@28.5, @193.5, @NO],
                    @[@25.5, @199, @NO],
                    @[@36.5, @178, @YES],
                    @[@34.5, @185.5, @NO],
                    @[@31, @194.5, @NO],
                    @[@38, @170, @YES],
                    @[@37, @175.5, @NO],
                    @[@51.5, @156.5, @YES],
                    @[@49, @166, @NO],
                    @[@50.5, @169, @YES],
                    @[@49, @175.5, @NO],
                    @[@48.5, @183, @NO],
                    @[@47.5, @171.5, @YES],
                    @[@46.5, @181, @NO],
                    @[@57.5, @184, @YES],
                    @[@58, @190, @NO],
                    @[@59.5, @191, @YES],
                    @[@59.5, @205.5, @NO],
                    @[@75, @171.5, @YES],
                    @[@75.5, @182.5, @NO],
                    @[@76.5, @191, @NO],
                    @[@186.5, @138, @YES],
                    @[@187, @142.5, @NO],
                    @[@189.5, @149, @NO],
                    @[@190.04, @151.5, @NO],
                    @[@189.5, @163.5, @YES],
                    @[@191, @156, @NO],
                    @[@190.04, @151.5, @NO],
                    @[@191, @137.5, @YES],
                    @[@190.5, @143.5, @NO],
                    @[@190.04, @151.5, @NO],
                    @[@202.5, @130.5, @YES],
                    @[@200.5, @138, @NO],
                    @[@198.5, @145.5, @NO],
                    @[@221, @141, @YES],
                    @[@222.5, @150.5, @NO],
                    @[@228.5, @163.5, @NO],
                    @[@200.5, @185.5, @YES],
                    @[@205, @193, @NO],
                    @[@210, @198.5, @NO],
                    @[@198.5, @199, @YES],
                    @[@193, @195.5, @NO],
                    @[@248.5, @148, @YES],
                    @[@248.5, @151.5, @NO],
                    @[@253, @150.5, @YES],
                    @[@253, @155.5, @NO],
                    @[@255.5, @159.5, @NO],
                    @[@114.5, @133, @YES],
                    @[@116.5, @142.5, @NO],
                    @[@121.5, @145.5, @NO],
                    @[@124, @151.5, @NO],
                    @[@214, @113.5, @YES],
                    @[@216, @117, @NO],
                    @[@216, @121, @NO],
                    @[@210, @119.5, @YES],
                    @[@208.5, @129.5, @NO],
                    @[@218.5, @193, @YES],
                    @[@221, @194.5, @NO],
                    @[@226, @196.5, @NO],
                    @[@234.5, @203.5, @NO],
                    @[@154.5, @171.5, @YES],
                    @[@157, @178, @NO],
                    @[@163.5, @185.5, @NO],
                ]],
                [NSMutableArray arrayWithArray:@[
                    @[@30.5, @209.5, @YES],
                    @[@45, @209.5, @NO],
                    @[@59, @206, @NO],
                    @[@76.5, @196.5, @NO],
                    @[@93.5, @191.5, @NO],
                    @[@109.5, @198, @NO],
                    @[@122.25, @203.75, @NO],
                    @[@135, @209.5, @YES],
                    @[@122.25, @203.75, @NO],
                    @[@122.25, @203.75, @YES],
                    @[@135, @200, @NO],
                    @[@145, @201.5, @NO],
                    @[@154.5, @203.75, @NO],
                    @[@168, @206, @NO],
                    @[@190, @213.5, @NO],
                    @[@180.5, @216, @YES],
                    @[@193, @213.5, @NO],
                    @[@203.5, @208, @NO],
                    @[@217.5, @208, @NO],
                    @[@232, @208, @NO],
                    @[@252, @203.75, @NO],
                    @[@51.5, @237.5, @YES],
                    @[@65.5, @237.5, @NO],
                    @[@82.5, @234, @NO],
                    @[@99.5, @237.5, @NO],
                    @[@124, @240.5, @NO],
                    @[@168, @245, @NO],
                    @[@135, @254.5, @YES],
                    @[@158.5, @248.5, @NO],
                    @[@180.5, @237.5, @NO],
                    @[@193, @231, @NO],
                    @[@211.5, @231, @NO],
                    @[@233.5, @231, @NO],
                    @[@81, @261, @YES],
                    @[@93.5, @258.5, @NO],
                    @[@118, @261, @NO],
                    @[@146, @262, @NO],
                    @[@168, @262, @NO],
                    @[@190, @254.5, @NO],
                    @[@213, @252, @NO],
                ]],
                [NSMutableArray arrayWithArray:@[
                    @[@245, @125, @YES],
                    @[@251.5, @134.5, @NO],
                    @[@264, @147, @NO],
                    @[@263, @130.5, @NO],
                    @[@260.5, @115, @NO],
                    @[@255.5, @101.5, @NO],
                    @[@251.5, @93, @NO],
                    @[@247.5, @85.5, @NO],
                    @[@241.5, @77, @NO],
                    @[@236.5, @76.5, @NO],
                    @[@234, @76.5, @NO],
                    @[@230, @77, @NO],
                    @[@226, @78.5, @NO],
                    @[@222.5, @76.5, @NO],
                    @[@219.5, @75.5, @NO],
                    @[@215.5, @76.5, @NO],
                    @[@210.5, @76.5, @NO],
                    @[@206, @78.5, @NO],
                    @[@203, @77, @NO],
                    @[@199, @75.5, @NO],
                    @[@195, @75.5, @NO],
                    @[@188, @75.5, @NO],
                    @[@181.5, @75.5, @NO],
                    @[@178.5, @77, @NO],
                    @[@172, @75.5, @NO],
                    @[@166, @75.5, @NO],
                    @[@162, @74.5, @NO],
                    @[@156.5, @76.5, @NO],
                    @[@153, @74.5, @NO],
                    @[@146, @74.5, @NO],
                    @[@151.5, @73, @NO],
                    @[@155, @70, @NO],
                    @[@156.5, @68, @NO],
                    @[@159.5, @65.5, @NO],
                    @[@162, @62, @NO],
                    @[@166, @62, @NO],
                    @[@173.5, @62, @NO],
                    @[@179, @62, @NO],
                    @[@184, @59, @NO],
                    @[@186, @55, @NO],
                    @[@192.5, @54, @NO],
                    @[@196, @56.5, @NO],
                    @[@200, @55, @NO],
                    @[@204, @56.5, @NO],
                    @[@206, @52.5, @NO],
                    @[@210.5, @50.5, @NO],
                    @[@216.5, @50.5, @NO],
                    @[@206, @43, @NO],
                    @[@192.5, @35.5, @NO],
                    @[@175, @28.5, @NO],
                    @[@155, @24.5, @NO],
                    @[@139.5, @23.5, @NO],
                    @[@122.5, @24.5, @NO],
                    @[@106, @27, @NO],
                    @[@93, @32, @NO],
                    @[@81.5, @37, @NO],
                    @[@87, @40, @NO],
                    @[@91, @44, @NO],
                    @[@94, @49.5, @NO],
                    @[@94.5, @55, @NO],
                    @[@91, @63, @NO],
                    @[@85.5, @68, @NO],
                    @[@81.5, @70, @NO],
                    @[@77, @70, @NO],
                    @[@70, @67, @NO],
                    @[@65, @63, @NO],
                    @[@61.5, @56.5, @NO],
                    @[@61.5, @50.5, @NO],
                    @[@49, @61.5, @NO],
                    @[@40.5, @71.5, @NO],
                    @[@33, @83, @NO],
                    @[@27.5, @94, @NO],
                    @[@26, @100, @NO],
                    @[@29.5, @100, @NO],
                    @[@33, @99, @NO],
                    @[@39.5, @103, @NO],
                    @[@45.5, @103, @NO],
                    @[@51.5, @108, @NO],
                    @[@55, @107, @NO],
                    @[@60, @109.5, @NO],
                    @[@57.5, @110.5, @NO],
                    @[@51.5, @112, @NO],
                    @[@46.5, @111, @NO],
                    @[@44.5, @112, @NO],
                    @[@40.5, @112, @NO],
                    @[@37.5, @112, @NO],
                    @[@35.5, @114, @NO],
                    @[@33.5, @113, @NO],
                    @[@31.5, @113, @NO],
                    @[@26, @110.5, @NO],
                    @[@20.5, @113, @NO],
                    @[@18, @121.5, @NO],
                    @[@16, @147.5, @NO],
                    @[@20.5, @177.5, @NO],
                    @[@27.5, @170.5, @NO],
                    @[@33, @166.5, @NO],
                    @[@44.5, @154, @NO],
                    @[@55, @142.5, @NO],
                    @[@245, @125, @YES],
                    @[@234, @130.5, @NO],
                    @[@245, @125, @YES],
                    @[@243.17, @134.5, @NO],
                    @[@243.17, @146, @NO],
                    @[@234, @130.5, @YES],
                    @[@222.5, @107, @NO],
                    @[@214, @99.5, @NO],
                    @[@206, @109.5, @NO],
                    @[@195, @122, @NO],
                    @[@190.5, @119.5, @NO],
                    @[@173.5, @137.5, @NO],
                    @[@159.5, @158, @NO],
                    @[@234, @130.5, @YES],
                    @[@238, @137.5, @NO],
                    @[@243.17, @146, @NO],
                    @[@159.5, @158, @YES],
                    @[@151.5, @149, @NO],
                    @[@131, @129, @NO],
                    @[@123.5, @109.5, @NO],
                    @[@119, @109.5, @NO],
                    @[@112.5, @99.5, @NO],
                    @[@159.5, @158, @YES],
                    @[@159.5, @160.5, @NO],
                    @[@163, @164, @NO],
                    @[@170.25, @171.25, @NO],
                    @[@112.5, @99.5, @YES],
                    @[@101, @108, @NO],
                    @[@97.5, @115, @NO],
                    @[@86.5, @127.5, @NO],
                    @[@80.5, @125, @NO],
                    @[@112.5, @99.5, @YES],
                    @[@108.5, @107, @NO],
                    @[@107, @115, @NO],
                    @[@80.5, @125, @YES],
                    @[@65, @145, @NO],
                    @[@55, @142.5, @NO],
                    @[@80.5, @125, @YES],
                    @[@80.5, @137.5, @NO],
                    @[@82.5, @149, @NO],
                    @[@55, @142.5, @YES],
                    @[@58.5, @148.5, @NO],
                    @[@60, @155.5, @NO],
                    @[@60, @165, @NO],
                    @[@65, @174.5, @NO],
                    @[@177.5, @178.5, @YES],
                    @[@170.25, @171.25, @NO],
                    @[@254.5, @166, @YES],
                    @[@245, @149, @NO],
                    @[@243.17, @146, @NO],
                    @[@170.25, @171.25, @YES],
                    @[@184, @166.5, @NO],
                    @[@185.16, @168, @NO],
                    @[@192.5, @177.5, @YES],
                    @[@185.16, @168, @NO],
                    @[@185.16, @168, @YES],
                    @[@192.5, @165, @NO],
                    @[@199, @168, @NO],
                    @[@209, @174.5, @NO],
                    @[@219.5, @178.5, @NO],
                    @[@228, @185.5, @NO],
                    @[@234, @187, @NO],
                    @[@249.5, @199, @NO],
                    @[@104, @140, @YES],
                    @[@104, @131.5, @NO],
                    @[@105.5, @122, @NO],
                ]]
            ],
            @"Head": @[
                [NSMutableArray arrayWithArray: @[
                    @[@55.5, @21, @NO],
                    @[@71, @81, @NO],
                    @[@83, @104, @NO],
                    @[@100.5, @123.5, @NO],
                    @[@127.5, @146, @NO],
                    @[@151, @151.5, @NO],
                    @[@187, @134, @NO],
                    @[@214, @104, @NO],
                    @[@222.5, @92, @NO],
                    @[@224.5, @42.5, @NO],
                    @[@212.5, @32.5, @NO],
                    @[@196, @35.5, @NO],
                    @[@185, @52.5, @NO],
                    @[@183, @75.5, @NO],
                    @[@187, @88, @NO]
                ]],
                [NSMutableArray arrayWithArray: @[
                    @[@178, @93, @NO],
                    @[@169.5, @91.5, @NO],
                    @[@160, @93.5, @NO],
                    @[@152, @94.5, @NO],
                    @[@142.5, @93.5, @NO],
                    @[@134, @92, @NO],
                    @[@127.5, @91.5, @NO],
                    @[@120, @93, @NO],
                    @[@115.5, @95, @NO],
                    @[@121.5, @97.5, @NO],
                    @[@126, @101, @NO],
                    @[@130.5, @106, @NO],
                    @[@136.5, @108.5, @NO],
                    @[@144, @109.5, @NO],
                    @[@151, @108.5, @NO],
                    @[@158.5, @109.5, @NO],
                    @[@164.5, @108.5, @NO],
                    @[@171, @104.5, @NO],
                    @[@178, @96.5, @NO],
                    @[@182.5, @90.5, @NO],
                    @[@174.5, @89.5, @NO],
                    @[@165.5, @88.5, @NO],
                    @[@156.5, @86.5, @NO],
                    @[@148, @86, @NO],
                    @[@138, @87.5, @NO],
                    @[@129, @89.5, @NO],
                    @[@119, @90.5, @NO],
                    @[@112, @90, @NO],
                    @[@121.5, @84, @NO],
                    @[@130.5, @77.5, @NO],
                    @[@136.5, @74, @NO],
                    @[@141.5, @75.5, @NO],
                    @[@147, @77.5, @NO],
                    @[@153.5, @76.5, @NO],
                    @[@160, @75.5, @NO],
                    @[@165.5, @73, @NO],
                    @[@168.5, @77.5, @NO],
                    @[@173.5, @82.5, @NO],
                    @[@181, @87, @NO]
                ]],
                [NSMutableArray arrayWithArray: @[
                    @[@182.5, @95.5, @NO],
                    @[@187, @101.5, @NO],
                    @[@189.5, @108, @NO],
                    @[@186, @117, @NO],
                    @[@179, @125.5, @NO],
                    @[@170, @132.5, @NO],
                    @[@160.5, @125.5, @NO],
                    @[@150, @121.5, @NO],
                    @[@140.5, @121.5, @NO],
                    @[@128.5, @125.5, @NO],
                    @[@120.5, @135, @NO],
                    @[@114, @147.5, @NO],
                    @[@102.5, @140.5, @NO],
                    @[@94.5, @130.5, @NO],
                    @[@86, @121.5, @NO],
                    @[@86, @135, @NO],
                    @[@86, @163.5, @NO],
                    @[@86, @180.5, @NO],
                    @[@79, @192, @NO],
                    @[@67.5, @200.5, @NO],
                    @[@56.5, @207.5, @NO],
                    @[@74, @214, @NO],
                    @[@87.5, @222.5, @NO],
                    @[@98, @236.5, @NO],
                    @[@112, @254, @NO],
                    @[@131, @272, @NO],
                    @[@150, @278.5, @NO],
                    @[@164, @278.5, @NO],
                    @[@179, @270.5, @NO],
                    @[@192.5, @254, @NO],
                    @[@202.5, @232.5, @NO],
                    @[@212, @216.5, @NO],
                    @[@226.5, @210, @NO],
                    @[@230, @210, @NO],
                    @[@223.5, @194.5, @NO],
                    @[@214, @166, @NO],
                    @[@212, @143, @NO],
                    @[@212, @119.5, @NO],
                    @[@205, @130.5, @NO],
                    @[@197, @138.5, @NO],
                    @[@189.5, @147.5, @NO],
                    @[@173, @163.5, @NO],
                    @[@163, @178, @NO],
                    @[@154.5, @199.5, @NO],
                    @[@151.5, @225.5, @NO],
                    @[@151.5, @254, @NO],
                    @[@151.5, @272, @NO]
                ]]
            ]
        };
    }
    return self;
}

- (void)drawRect:(CGRect)rect {
    NSLog(@"Called");
    if (self.reset) {
        return [self resetPaths];
    }
    
    if (!self.isReadyToDraw || !self.templates[self.templateName]) {
        return;
    }

    NSArray *coordinates = self.templates[self.templateName];

    if (!self.isCoordinatesNormalized) {
        [self normalizeCoordinates:coordinates];
    }

    if (self.coordinatesIdx == [[coordinates firstObject] count]) {
        [self strokePaths];
        self.isDrawingDone = YES;
        return;
    }

    UIBezierPath *firstLinePath = [UIBezierPath new];
    UIBezierPath *secondLinePath = [UIBezierPath new];
    UIBezierPath *thirdLinePath = [UIBezierPath new];

    NSArray *firstCoords = [coordinates firstObject];
    NSArray *secondCoords = [coordinates objectAtIndex:1];
    NSArray *thirdCoords = [coordinates lastObject];
    
    BOOL p1JustMoveTo = [[[firstCoords objectAtIndex:self.coordinatesIdx] objectAtIndex:2] boolValue];
    BOOL p2JustMoveTo = [[[secondCoords objectAtIndex:self.coordinatesIdx] objectAtIndex:2] boolValue];
    BOOL p3JustMoveTo = [[[thirdCoords objectAtIndex:self.coordinatesIdx] objectAtIndex:2] boolValue];
    
    [self setCoordinatesForLinePath:firstLinePath
                        coordinates:[firstCoords objectAtIndex:self.coordinatesIdx]
                        prevCoordinates:[firstCoords objectAtIndex:self.coordinatesIdx - 1]
                        justMoveTo:p1JustMoveTo];
    [self setCoordinatesForLinePath:secondLinePath
                        coordinates:[secondCoords objectAtIndex:self.coordinatesIdx]
                        prevCoordinates:[secondCoords objectAtIndex:self.coordinatesIdx - 1]
                        justMoveTo:p2JustMoveTo];
    [self setCoordinatesForLinePath:thirdLinePath
                        coordinates:[thirdCoords objectAtIndex:self.coordinatesIdx]
                        prevCoordinates:[thirdCoords objectAtIndex:self.coordinatesIdx - 1]
                        justMoveTo:p3JustMoveTo];

    [self.firstPath appendPath:firstLinePath];
    [self.secondPath appendPath:secondLinePath];
    [self.thirdPath appendPath:thirdLinePath];

    [self strokePaths];

    self.coordinatesIdx++;
}

- (void)drawWithInterval:(double)interval andCallback:(nonnull void (^)(void))callback {
    __weak Canvas *weakSelf = self;
    [NSTimer scheduledTimerWithTimeInterval:interval repeats:YES block:^(NSTimer *timer) {
        __strong Canvas *strongSelf = weakSelf;
        
        if (strongSelf.isDrawingDone) {
            [timer invalidate];
            
            callback();
        }
        
        [strongSelf setNeedsDisplay];
    }];
};

-(void)normalizeCoordinates: (NSArray *)coordinatesArray {
    __block NSInteger maxCount = [[coordinatesArray firstObject] count];
    [coordinatesArray enumerateObjectsUsingBlock:^(NSMutableArray *arr, NSUInteger idx, BOOL *stop) {
        maxCount = MAX([arr count], maxCount);
    }];
    
    [coordinatesArray enumerateObjectsUsingBlock:^(NSMutableArray *arr, NSUInteger idx, BOOL *stop) {
        while([arr count] != maxCount) {
            [arr addObject:[arr lastObject]];
        }
    }];
    
    self.isCoordinatesNormalized = YES;
}

-(void)setCoordinatesForLinePath:(UIBezierPath *)path coordinates:(NSArray *)coordinates prevCoordinates:(NSArray *)prevCoordinates justMoveTo:(BOOL)justMoveTo {
    NSInteger coordinatesCount = [coordinates count];
    float xCoord = [coordinates[0] floatValue];
    float yCoord = [coordinates[1] floatValue];
    float xPrevCoord = [prevCoordinates[0] floatValue];
    float yPrevCoord = [prevCoordinates[1] floatValue];
    
    [path moveToPoint:CGPointMake(xPrevCoord, yPrevCoord)];
    
    if (xCoord == [@-1 floatValue] && yCoord == [@-1 floatValue]) {
        [path closePath];
        
        return;
    }
    
    if (coordinatesCount == 7) {
        float controlPoint1X = [coordinates[3] floatValue];
        float controlPoint1Y = [coordinates[4] floatValue];
        float controlPoint2X = [coordinates[5] floatValue];
        float controlPoint2Y = [coordinates[6] floatValue];
        
        [path addCurveToPoint:CGPointMake(xCoord, yCoord) controlPoint1:CGPointMake(controlPoint1X, controlPoint1Y) controlPoint2:CGPointMake(controlPoint2X, controlPoint2Y)];
        
        return;
    }
    
    if (justMoveTo == YES) {
        return;
    }
    
    
    [path addLineToPoint:CGPointMake(xCoord, yCoord)];
}

-(void)strokePaths {
    UIColor *firstColor = [self.colors firstObject];
    UIColor *secondColor = [self.colors objectAtIndex:1];
    UIColor *thirdColor = [self.colors lastObject];

    [firstColor setStroke];
    [self.firstPath stroke];
    [secondColor setStroke];
    [self.secondPath stroke];
    [thirdColor setStroke];
    [self.thirdPath stroke];
}

-(void)resetPaths {
    [self.firstPath removeAllPoints];
    [self.secondPath removeAllPoints];
    [self.thirdPath removeAllPoints];
    
    self.coordinatesIdx = 1;
    self.reset = NO;
    self.isCoordinatesNormalized = NO;
    self.isDrawingDone = NO;
}

- (UIImage *)takeSnapshot {
    UIGraphicsBeginImageContext(CGSizeMake(self.bounds.size.width * 2, self.bounds.size.height * 2));
    [self drawViewHierarchyInRect:CGRectMake(self.bounds.size.width / 2, self.bounds.size.height / 2, self.bounds.size.width, self.bounds.size.height) afterScreenUpdates:YES];
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    return image;
}

@end
